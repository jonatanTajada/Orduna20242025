package componentesJavaSwingEjercicios2;

import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextField;

public class FormMatriculaV2 implements ActionListener {

	private final int ANCHO = 550;
	private final int ALTO = 450;
	private JFrame ventana;
	private JLabel lMatricula;
	private JTextField tMatricula;
	private JButton matricular;
	private JPanel panelNorte;
	
	// Lista de barcos registrados para almacenar todos los barcos
	private ArrayList<Barco> barcosRegistrados;

	public static void main(String[] args) {
		new FormMatriculaV2();
	}

	public FormMatriculaV2() {

		barcosRegistrados = new ArrayList<>();

		// Crear la ventana
		ventana = new JFrame("Matriculación barco");
		ventana.setSize(ANCHO, ALTO);
		ventana.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		ventana.setLocationRelativeTo(null);
		ventana.setLayout(new FlowLayout());

		// Crear el panel
		panelNorte = new JPanel();
		panelNorte.setLayout(new FlowLayout());

		// Crear y añadir la etiqueta de matrícula al panel
		lMatricula = new JLabel("Matricula:");
		panelNorte.add(lMatricula);

		// Crear el campo de texto 
		tMatricula = new JTextField("7º-PM-1-01-11", 15);
		panelNorte.add(tMatricula);

		// Crear el botón "Matricular"
		matricular = new JButton("Matricular");
		panelNorte.add(matricular);

		// Añadir el panel al JFrame
		ventana.add(panelNorte, BorderLayout.NORTH);

		// Añadir listener al botón
		añadirListenerBotones();

		// Hacer visible la ventana
		ventana.setVisible(true);
	}

	public void añadirListenerBotones() {
		
		matricular.addActionListener(this);
	}

	@Override
	public void actionPerformed(ActionEvent evento) {
		
		String matricula = tMatricula.getText();

		// Verificar si la matrícula ya está registrada 
		if (existeBarcoPorMatricula(matricula)) {
			
			// Mostrar ventana emergente de advertencia si la matrícula ya existe
			JOptionPane.showMessageDialog(ventana, "Error: La matricula '" + matricula + "' ya esta registrada. Introduce una nueva.", "Matricula duplicada", JOptionPane.WARNING_MESSAGE);
			return;
		}

		// Mostrar ventanas emergentes para recoger los datos adicionales
		String nombre = JOptionPane.showInputDialog(ventana, "Introduce el nombre del barco:");
		String esloraStr = JOptionPane.showInputDialog(ventana, "Introduce la eslora del barco (en metros):");
		String cabinasStr = JOptionPane.showInputDialog(ventana, "Introduce el numero de cabinas:");

		// Validación de los datos introducidos
		try {
			float eslora = Float.parseFloat(esloraStr);
			int cabinas = Integer.parseInt(cabinasStr);

			Barco nuevoBarco = new Barco(matricula, nombre, eslora, cabinas);

			barcosRegistrados.add(nuevoBarco);

			// Mostrar los datos del nuevo barco
			System.out.println("\nBarco matriculado con exito:");
			System.out.println(nuevoBarco.toString());
		} catch (NumberFormatException e) {
			JOptionPane.showMessageDialog(ventana, "Error: Asegurate de introducir numeros válidos para la eslora y las cabinas.", "Error de entrada", JOptionPane.ERROR_MESSAGE);
		}
	}

	// Metodo para verificar si ya existe
	private boolean existeBarcoPorMatricula(String matricula) {
		for (Barco barco : barcosRegistrados) {
			if (barco.getMatricula().equals(matricula)) {
				return true; 
			}
		}
		return false; 
	}
}
